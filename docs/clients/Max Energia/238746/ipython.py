from erppeek import Client
c = Client('http://localhost:12000', 'comer_gasiluz', 'gisce', 'atrallum.gas')
from tqdm import tqdm


lead_obj = c.model('giscedata.crm.lead')
fact_serv_obj = c.model('giscedata.crm.lead.facturacio.services')
scoring_obj = c.model('giscedata.crm.lead.scoring.log') # link via crm_lead_id

# ids = [55214, 55210, 55345, 55218, 55225, 55285, 55281, 55227, 55269, 55283, 55279, 55301, 55212, 55271, 55273, 55275, 55277, 55262, 55260, 55264, 55373, 55357, 55355, 55454, 55481, 55445, 55458, 55258, 55361, 55408, 55379, 55353, 55351, 55313, 55371, 55410, 55405, 55377, 55383, 55395, 55456, 55365, 55385, 55397, 55403, 55347, 55321, 55391, 55414, 55413, 55349, 55359, 55401, 55479, 55381, 55447, 55369, 55375, 55363, 55311, 55393, 55406, 55464, 55421, 55248, 55240, 55389, 55387, 55299, 55231, 55367, 55303, 55399, 55323, 55252, 55232, 55234, 55250, 55317, 55254, 55309, 55229, 55337, 55307, 55339, 55293, 55305, 55331, 55297, 55329, 55238, 55257, 55335, 55291, 55236, 55289, 55223, 55244, 55246, 55315, 55242, 55287, 55343, 55439, 55333, 55341, 55416, 55419, 55450, 55452, 55267, 55319, 55488, 55295, 55220, 55483, 55485, 55325, 55474, 55472, 55470, 55475, 55468, 55477, 55466, 55216, 55423, 55327, 55430, 55426, 55431, 55443, 55433, 55437, 55441, 55435]

# ids = [55373, 55362, 55357, 55346, 55355, 55344, 55481, 55471, 55445, 55436, 55458, 55448, 55408, 55398, 55379, 55368, 55353, 55342, 55351, 55340, 55371, 55360, 55410, 55400, 55405, 55394, 55377, 55366, 55383, 55372, 55395, 55384, 55456, 55446, 55385, 55374, 55397, 55386, 55403, 55392, 55347, 55336, 55391, 55380, 55349, 55338, 55359, 55348, 55381, 55370, 55447, 55438, 55369, 55358, 55375, 55364, 55393, 55382, 55406, 55396, 55464, 55449, 55421, 55411, 55389, 55378, 55387, 55376, 55367, 55356, 55450, 55440, 55452, 55442, 55488, 55478, 55483, 55473, 55470, 55455, 55468, 55453, 55477, 55467, 55466, 55451, 55423, 55412, 55430, 55417, 55426, 55415, 55431, 55418, 55443, 55434, 55433, 55420, 55437, 55425, 55435, 55422]

ids = [55445, 55436, 55353, 55342, 55351, 55340, 55347, 55336, 55349, 55338, 55447, 55438, 55406, 55396, 55450, 55440, 55452, 55442, 55430, 55417, 55426, 55415, 55437, 55425, 55435, 55422]

leads_fields = ['scoring_log_ids', 'serveis', 'state']
leads_read = lead_obj.read(ids,leads_fields)

for lead in tqdm(leads_read):
    try:
        if lead['state'] == 'draft':
            #if len(lead['scoring_log_ids']) > 0: Si n'hi han, que petin
            #    scoring_obj.unlink([scoring[0] for scoring in lead['scoring_log_ids']])
            if len(lead['serveis']) > 0:
                fact_serv_obj.unlink([servei for servei in lead['serveis']])
                lead_obj.unlink([lead['id']])
    except Exception as e:
        print(str(e))
        print('ERROR: {}'.format(lead['id']))
