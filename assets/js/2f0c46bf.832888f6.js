"use strict";(self.webpackChunkmarkdown_website=self.webpackChunkmarkdown_website||[]).push([[2330],{9243:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>t,contentTitle:()=>c,default:()=>g,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"gisce/procediments/sips_rfc","title":"Introducci\xf3n","description":"contiene datos de cliente y no se aconseja compartir","source":"@site/docs/gisce/procediments/sips_rfc.md","sourceDirName":"gisce/procediments","slug":"/gisce/procediments/sips_rfc","permalink":"/docs/gisce/procediments/sips_rfc","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"gisceSidebar","previous":{"title":"Revisar Dades Mako","permalink":"/docs/gisce/procediments/revisar_dades_mako"},"next":{"title":"Traduccio d\'un modul","permalink":"/docs/gisce/procediments/translate_module"}}');var o=i(4848),a=i(8453);const r={},c="Introducci\xf3n",t={},d=[{value:"Configuraci\xf3n",id:"configuraci\xf3n",level:2},{value:"Importar datos de cups",id:"importar-datos-de-cups",level:3},{value:"Importar datos de consumos",id:"importar-datos-de-consumos",level:3},{value:"Una explicaci\xf3n mas detallada",id:"una-explicaci\xf3n-mas-detallada",level:2}];function l(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"introducci\xf3n",children:"Introducci\xf3n"})}),"\n",(0,o.jsx)(e.admonition,{title:"title",type:"danger",children:(0,o.jsx)(e.p,{children:"contiene datos de cliente y no se aconseja compartir"})}),"\n",(0,o.jsx)(e.p,{children:"En ocasiones la API del SIPS de la CNMC deja de funcionar. Para tener los datos del SIPS siempre disponibles se puede pedir la base de datos a la CNMC y cargarla en nuestro sistema. Haciendo esto conseguimos que la fuente de datos se obtenga de la base de datos cargada cuando la API no funciona."}),"\n",(0,o.jsx)(e.h2,{id:"configuraci\xf3n",children:"Configuraci\xf3n"}),"\n",(0,o.jsx)(e.p,{children:"La base de datos debe tener el formato est\xe1ndar proporcionado por la CNMC (fichero csv con cabecera y con los datos separados por comas)"}),"\n",(0,o.jsx)(e.p,{children:"En el servidor que tenga el mongo:"}),"\n",(0,o.jsx)(e.p,{children:"Primero crear el indice de la tabla aunque esta no exista."}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-Shell",children:"$ /opt/mongodb-3.0.15/mongo\n> use DB_NAME\n> db.cnmc_sips.ensureIndex({'cups': 1}, {background: true})\n> db.cnmc_sips_consums.ensureIndex({'cups': 1}, {background: true})\n"})}),"\n",(0,o.jsx)(e.p,{children:"Despu\xe9s se debe descargar la herramienta de mongoimport. Segun la version de mongo, descargar uno de los siguientes ficheros:"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsxs)(e.li,{children:["3.6.23 -> ",(0,o.jsx)(e.a,{href:"https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-3.6.23.tgz",children:"https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-3.6.23.tgz"})]}),"\n",(0,o.jsxs)(e.li,{children:["3.4.24 -> ",(0,o.jsx)(e.a,{href:"https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-3.4.24.tgz",children:"https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-3.4.24.tgz"})]}),"\n"]}),"\n",(0,o.jsxs)(e.p,{children:["\u26a0\ufe0f"," Se debe hacer con mongoimport de la versi\xf3n >= 3.4. Probado con la versi\xf3n 3.6.23."]}),"\n",(0,o.jsxs)(e.p,{children:["El ",(0,o.jsx)(e.code,{children:"mongoimport"})," se encuentra dentro del fichero descargado en la carpeta ",(0,o.jsx)(e.code,{children:"/bin/"}),":"]}),"\n",(0,o.jsx)(e.h3,{id:"importar-datos-de-cups",children:"Importar datos de cups"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-Shell",children:"./mongoimport -c cnmc_sips --port PORT_MONGO --host IP_MONGO -d DB_NAME --file=$FILEPATH/SIPS.csv --type=csv --upsertFields=cups --columnsHaveTypes --fieldFile=header.csv\n"})}),"\n",(0,o.jsxs)(e.p,{children:["el fichero ",(0,o.jsx)(e.code,{children:"header.csv"})," es el siguiente:"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-plaintext",children:"codigoEmpresaDistribuidora.string()\ncups.string()\nnombreEmpresaDistribuidora.string()\ncodigoPostalPS.string()\nmunicipioPS.string()\ncodigoProvinciaPS.string()\nfechaAltaSuministro.string()\ncodigoTarifaATREnVigor.string()\ncodigoTensionV.string()\npotenciaMaximaBIEW.string()\npotenciaMaximaAPMW.string()\ncodigoClasificacionPS.string()\ncodigoDisponibilidadICP.string()\ntipoPerfilConsumo.string()\nvalorDerechosExtensionW.string()\nvalorDerechosAccesoW.string()\ncodigoPropiedadEquipoMedida.string()\ncodigoPropiedadICP.string()\npotenciasContratadasEnWP1.string()\npotenciasContratadasEnWP2.string()\npotenciasContratadasEnWP3.string()\npotenciasContratadasEnWP4.string()\npotenciasContratadasEnWP5.string()\npotenciasContratadasEnWP6.string()\nfechaUltimoMovimientoContrato.string()\nfechaUltimoCambioComercializador.string()\nfechaLimiteDerechosReconocidos.string()\nfechaUltimaLectura.string()\ninformacionImpagos.string()\nimporteDepositoGarantiaEuros.string()\ntipoIdTitular.string()\nesViviendaHabitual.string()\ncodigoComercializadora.string()\ncodigoTelegestion.string()\ncodigoFasesEquipoMedida.string()\ncodigoAutoconsumo.string()\ncodigoTipoContrato.string()\ncodigoPeriodicidadFacturacion.string()\ncodigoBIE.string()\nfechaEmisionBIE.string()\nfechaCaducidadBIE.string()\ncodigoAPM.string()\nfechaEmisionAPM.string()\nfechaCaducidadAPM.string()\nrelacionTransformacionIntensidad.string()\nCNAE.string()\ncodigoModoControlPotencia.string()\npotenciaCGPW.string()\ncodigoDHEquipoDeMedida.string()\ncodigoAccesibilidadContador.string()\ncodigoPSContratable.string()\nmotivoEstadoNoContratable.string()\ncodigoTensionMedida.string()\ncodigoClaseExpediente.string()\ncodigoMotivoExpediente.string()\ncodigoTipoSuministro.string()\naplicacionBonoSocial.string()\n\n"})}),"\n",(0,o.jsx)(e.h3,{id:"importar-datos-de-consumos",children:"Importar datos de consumos"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-Shell",children:"./mongoimport -c cnmc_sips_consums --port PORT_MONGO --host IP_MONGO -d DB_NAME --file=$FILEPATH/SIPS.csv --type=csv --upsertFields=cups --columnsHaveTypes --fieldFile=consums.csv\n"})}),"\n",(0,o.jsxs)(e.p,{children:["el fichero ",(0,o.jsx)(e.code,{children:"consums.csv"})," es el siguiente:"]}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-plaintext",children:"cups.string()\nfechaInicioMesConsumo.string()\nfechaFinMesConsumo.string()\ncodigoTarifaATR.string()\nconsumoEnergiaActivaEnWhP1.string()\nconsumoEnergiaActivaEnWhP2.string()\nconsumoEnergiaActivaEnWhP3.string()\nconsumoEnergiaActivaEnWhP4.string()\nconsumoEnergiaActivaEnWhP5.string()\nconsumoEnergiaActivaEnWhP6.string()\nconsumoEnergiaReactivaEnVArhP1.string()\nconsumoEnergiaReactivaEnVArhP2.string()\nconsumoEnergiaReactivaEnVArhP3.string()\nconsumoEnergiaReactivaEnVArhP4.string()\nconsumoEnergiaReactivaEnVArhP5.string()\nconsumoEnergiaReactivaEnVArhP6.string()\npotenciaDemandadaEnWP1.string()\npotenciaDemandadaEnWP2.string()\npotenciaDemandadaEnWP3.string()\npotenciaDemandadaEnWP4.string()\npotenciaDemandadaEnWP5.string()\npotenciaDemandadaEnWP6.string()\ncodigoDHEquipoDeMedida.string()\ncodigoTipoLectura.string()\n"})}),"\n",(0,o.jsx)(e.p,{children:"Dependiendo de la m\xe1quina y del tama\xf1o de la base de datos la importaci\xf3n puede tardar unas horas."}),"\n",(0,o.jsx)(e.p,{children:"Ya hemos acabado!"}),"\n",(0,o.jsx)(e.h2,{id:"una-explicaci\xf3n-mas-detallada",children:"Una explicaci\xf3n mas detallada"}),"\n",(0,o.jsx)(e.p,{children:"Descargamos los 2 zips en local (no los descomprimimos)"}),"\n",(0,o.jsxs)(e.p,{children:["Subimos con SCP los zips:\n",(0,o.jsx)(e.code,{children:"scp /home/alex/descargas/202206_SIPS2_CONSUMOS_ELECTRICIDAD_peninsular-002.zip gisce@tec.gisce.cloud:/home/gisce/"})]}),"\n",(0,o.jsx)(e.p,{children:"Pasamos los archivos de home/gisce a la m\xe1quina de mongo:"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.code,{children:"scp /202206_SIPS2_CONSUMOS_ELECTRICIDAD_peninsular-002.zip gisce@mongo:/mnt/HC_Volume_33324861/tmp/"})," \u2190 puede cambiar el nombre HC\u2026"]}),"\n",(0,o.jsxs)(e.p,{children:["Vamos a carpeta temporal(donde esta mongo y los archivos):\n",(0,o.jsx)(e.code,{children:"cd /mnt/HC_Volume_20025084/tmp"})]}),"\n",(0,o.jsxs)(e.p,{children:["Descomprimimos los archivos y eliminamos los zips. Dependiendo del tama\xf1o disponible en la maquina es mejor cargar el fichero de los puntos de suministro y despues el fichero de consumos.\n",(0,o.jsx)(e.code,{children:"unzip 202206_SIPS2_CONSUMOS_ELECTRICIDAD_peninsular-002.zip"})]}),"\n",(0,o.jsxs)(e.p,{children:["Como importar el archivo en la base de datos mongo (tarda unas horas):\nDebemos fijarnos en la base de datos de mongo \u201cc\u201d que por un archivo u otro es diferente y en el \u201c--fieldFile\u201d que tambi\xe9n es diferente. Por lo que la hace ip la podemos encontrar en el conf del mongo del mismo directorio\nPara importar ",(0,o.jsx)(e.strong,{children:"consumos"}),". Tener en cuenta que el campo -c tiene valor ",(0,o.jsx)(e.strong,{children:"cnmc_sips_consums"})," y el campo --fieldFile ",(0,o.jsx)(e.strong,{children:"consums.csv"}),":\n",(0,o.jsx)(e.code,{children:"./mongoimport -c cnmc_sips_consums --port 27017 --host 192.168.0.3 -d tec --file=202209_SIPS2_CONSUMOS_ELECTRICIDAD_peninsular.csv --type=csv --upsertFields=cups --columnsHaveTypes --fieldFile=consums.csv"})]}),"\n",(0,o.jsxs)(e.p,{children:["Para hacer los archivos de ",(0,o.jsx)(e.strong,{children:"puntos de suministro"}),". Tener en cuenta que el campo -c tiene valor ",(0,o.jsx)(e.strong,{children:"cnmc_sips"})," y el campo --fieldFile ",(0,o.jsx)(e.strong,{children:"header.csv"}),":\n",(0,o.jsx)(e.code,{children:"./mongoimport -c cnmc_sips --port 27017 --host 192.168.0.6 -d tec --file=202302_SIPS2_PS_ELECTRICIDAD_peninsular.csv --type=csv --upsertFields=cups --columnsHaveTypes --fieldFile=header.csv"})]}),"\n",(0,o.jsxs)(e.p,{children:["Abriendo otra terminal con",(0,o.jsx)(e.code,{children:" df -h"})," podemos saber el espacio que queda mientras se va importando"]})]})}function g(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(l,{...n})}):l(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>r,x:()=>c});var s=i(6540);const o={},a=s.createContext(o);function r(n){const e=s.useContext(a);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:r(n.components),s.createElement(a.Provider,{value:e},n.children)}}}]);